<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1768px" preserveAspectRatio="none" style="width:828px;height:1768px;background:#FFFFFF;" version="1.1" viewBox="0 0 828 1768" width="828px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cdms72lzbec7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="284" x="268.5" y="28.7219">OTA download from image provider</text><rect fill="#FFFFFF" filter="url(#f1cdms72lzbec7)" height="47.2" style="stroke:#000000;stroke-width:2.0;" width="504" x="277" y="122.9998"/><rect fill="#ADD8E6" filter="url(#f1cdms72lzbec7)" height="1314.0001" style="stroke:#000000;stroke-width:2.0;" width="801" x="10" y="243.3999"/><rect fill="#ADD8E6" filter="url(#f1cdms72lzbec7)" height="375.6" style="stroke:#000000;stroke-width:2.0;" width="761" x="30" y="473.6"/><rect fill="#ADD8E6" filter="url(#f1cdms72lzbec7)" height="151.2" style="stroke:#000000;stroke-width:2.0;" width="741" x="40" y="557.4"/><rect fill="#ADD8E6" height="44.7999" style="stroke:none;stroke-width:1.0;" width="741" x="40" y="663.8001"/><rect fill="#ADD8E6" height="103.9999" style="stroke:none;stroke-width:1.0;" width="761" x="30" y="745.2"/><rect fill="#90EE90" height="701.2" style="stroke:none;stroke-width:1.0;" width="801" x="10" y="856.1999"/><rect fill="#90EE90" filter="url(#f1cdms72lzbec7)" height="510" style="stroke:#000000;stroke-width:2.0;" width="781" x="20" y="1040.3999"/><rect fill="#90EE90" filter="url(#f1cdms72lzbec7)" height="375.6" style="stroke:#000000;stroke-width:2.0;" width="761" x="30" y="1167.7999"/><rect fill="#90EE90" filter="url(#f1cdms72lzbec7)" height="151.2" style="stroke:#000000;stroke-width:2.0;" width="741" x="40" y="1251.6"/><rect fill="#90EE90" height="44.7999" style="stroke:none;stroke-width:1.0;" width="741" x="40" y="1358"/><rect fill="#90EE90" height="103.9999" style="stroke:none;stroke-width:1.0;" width="761" x="30" y="1439.4"/><rect fill="#FFFFFF" filter="url(#f1cdms72lzbec7)" height="47.2" style="stroke:#000000;stroke-width:2.0;" width="504" x="277" y="1660.2"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="94" x2="94" y1="76.3998" y2="1724.4"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="323" x2="323" y1="76.3998" y2="1724.4"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="580" x2="580" y1="76.3998" y2="1724.4"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="714" x2="714" y1="76.3998" y2="1724.4"/><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="85" x="50" y="40.5999"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="57" y="60.6058">OTA cache</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="85" x="50" y="1723.4"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="57" y="1743.4059">OTA cache</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="69" x="287" y="40.5999"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="294" y="60.6058">OTA API</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="69" x="287" y="1723.4"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="294" y="1743.4059">OTA API</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="129" x="514" y="40.5999"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="521" y="60.6058">Protocol controller</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="129" x="514" y="1723.4"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="521" y="1743.4059">Protocol controller</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="110" x="657" y="40.5999"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="664" y="60.6058">Image provider</text><rect fill="#FEFECE" filter="url(#f1cdms72lzbec7)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="110" x="657" y="1723.4"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="664" y="1743.4059">Image provider</text><polygon fill="#A80036" points="334.5,103.9998,324.5,107.9998,334.5,111.9998,330.5,107.9998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="328.5" x2="579.5" y1="107.9998" y2="107.9998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="340.5" y="102.4768">subscribe_unid(unid, uiid)</text><path d="M277,122.9998 L337,122.9998 L337,129.9998 L327,139.9998 L277,139.9998 L277,122.9998 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="47.2" style="stroke:#000000;stroke-width:2.0;" width="504" x="277" y="122.9998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="292" y="136.0768">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="151" x="352" y="135.2187">[If no unids listening to uiid]</text><polygon fill="#A80036" points="702,158.1998,712,162.1998,702,166.1998,706,162.1998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="162.1998" y2="162.1998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="330.5" y="156.6768">Subscribe: ucl/OTA/info/uiid/all</text><polygon fill="#A80036" points="702,194.7998,712,198.7998,702,202.7998,706,198.7998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="198.7998" y2="198.7998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="330.5" y="193.2768">Subscribe: ucl/OTA/info/uiid/unid</text><polygon fill="#A80036" points="105.5,224.3999,95.5,228.3999,105.5,232.3999,101.5,228.3999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="322.5" y1="228.3999" y2="228.3999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="111.5" y="222.8769">unid listening to uiid</text><path d="M10,243.3999 L70,243.3999 L70,250.3999 L60,260.3999 L10,260.3999 L10,243.3999 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="1314.0001" style="stroke:#000000;stroke-width:2.0;" width="801" x="10" y="243.3999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="25" y="256.4769">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="125" x="85" y="255.6188">[specific unid available]</text><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="821" x="0" y="281.7999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="821" y1="281.7999" y2="281.7999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="821" y1="284.7999" y2="284.7999"/><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="127" x="347" y="270.9999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="109" x="353" y="287.0769">image availability</text><polygon fill="#A80036" points="334.5,322.1999,324.5,326.1999,334.5,330.1999,330.5,326.1999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="328.5" x2="713" y1="326.1999" y2="326.1999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="340.5" y="320.6769">Publish: ucl/OTA/info/uiid/unid</text><polygon fill="#A80036" points="105.5,351.7999,95.5,355.7999,105.5,359.7999,101.5,355.7999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="322.5" y1="355.7999" y2="355.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="111.5" y="350.2769">Cache image meta info for uiid/unid</text><polygon fill="#A80036" points="568.5,381.3999,578.5,385.3999,568.5,389.3999,572.5,385.3999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="574.5" y1="385.3999" y2="385.3999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="330.5" y="379.8769">image_available_callback(meta_info)</text><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="821" x="0" y="414.1999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="821" y1="414.1999" y2="414.1999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="821" y1="417.1999" y2="417.1999"/><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="121" x="350" y="403.3999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="103" x="356" y="419.4769">image download</text><polygon fill="#A80036" points="334.5,454.6,324.5,458.6,334.5,462.6,330.5,458.6" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="328.5" x2="579.5" y1="458.6" y2="458.6"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="340.5" y="453.077">get_by_unid(unid, uiid, image_ready_cb)</text><path d="M30,473.6 L90,473.6 L90,480.6 L80,490.6 L30,490.6 L30,473.6 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="375.6" style="stroke:#000000;stroke-width:2.0;" width="761" x="30" y="473.6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="45" y="486.677">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="102" x="105" y="485.8189">[image not cached]</text><polygon fill="#A80036" points="702,508.8,712,512.8,702,516.8,706,512.8" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="512.8" y2="512.8"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="330.5" y="507.277">Subscribe: ucl/OTA/data/uiid/unid</text><polygon fill="#A80036" points="702,538.4,712,542.4,702,546.4,706,542.4" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="542.4" y2="542.4"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="330.5" y="536.877">Publish: ucl/OTA/info/uiid/unid/get</text><path d="M40,557.4 L100,557.4 L100,564.4 L90,574.4 L40,574.4 L40,557.4 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="151.2" style="stroke:#000000;stroke-width:2.0;" width="741" x="40" y="557.4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="55" y="570.477">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="87" x="115" y="569.6189">[image received]</text><polygon fill="#A80036" points="334.5,592.6,324.5,596.6,334.5,600.6,330.5,596.6" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="328.5" x2="713" y1="596.6" y2="596.6"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="340.5" y="591.077">Publish: image file data message</text><polygon fill="#A80036" points="105.5,622.2,95.5,626.2,105.5,630.2,101.5,626.2" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="322.5" y1="626.2" y2="626.2"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="111.5" y="620.677">Cache image file</text><polygon fill="#A80036" points="568.5,651.8001,578.5,655.8001,568.5,659.8001,572.5,655.8001" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="574.5" y1="655.8001" y2="655.8001"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="330.5" y="650.277">image_ready_cb(OK, filepath)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="40" x2="781" y1="664.8001" y2="664.8001"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="104" x="45" y="675.019">[no image received]</text><polygon fill="#A80036" points="568.5,696.6,578.5,700.6,568.5,704.6,572.5,700.6" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="574.5" y1="700.6" y2="700.6"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="330.5" y="695.077">image_ready_cb(ERROR, "")</text><polygon fill="#A80036" points="702,733.2,712,737.2,702,741.2,706,737.2" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="737.2" y2="737.2"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="330.5" y="731.677">Unsubscribe: ucl/OTA/data/uiid/unid</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="791" y1="746.2" y2="746.2"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81" x="35" y="756.4189">[image cached]</text><polygon fill="#A80036" points="105.5,777.9999,95.5,781.9999,105.5,785.9999,101.5,781.9999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="322.5" y1="781.9999" y2="781.9999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="111.5" y="776.4769">get image filepath from cache</text><polygon fill="#A80036" points="311.5,807.5999,321.5,811.5999,311.5,815.5999,315.5,811.5999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="94.5" x2="317.5" y1="811.5999" y2="811.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="101.5" y="806.0769">image filepath</text><polygon fill="#A80036" points="568.5,837.1999,578.5,841.1999,568.5,845.1999,572.5,841.1999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="574.5" y1="841.1999" y2="841.1999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="330.5" y="835.6769">image_ready_cb(OK, filepath)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="811" y1="857.1999" y2="857.1999"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="142" x="15" y="867.4188">[no specific unid available]</text><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="821" x="0" y="892.1998"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="821" y1="892.1998" y2="892.1998"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="821" y1="895.1998" y2="895.1998"/><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="127" x="347" y="881.3998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="109" x="353" y="897.4768">image availability</text><polygon fill="#A80036" points="334.5,932.5999,324.5,936.5999,334.5,940.5999,330.5,936.5999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="328.5" x2="713" y1="936.5999" y2="936.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="340.5" y="931.0769">Publish: ucl/OTA/info/uiid/all</text><polygon fill="#A80036" points="105.5,962.1999,95.5,966.1999,105.5,970.1999,101.5,966.1999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="322.5" y1="966.1999" y2="966.1999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="111.5" y="960.6769">Cache image meta info for uiid/all</text><polygon fill="#A80036" points="105.5,991.7999,95.5,995.7999,105.5,999.7999,101.5,995.7999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="322.5" y1="995.7999" y2="995.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="164" x="111.5" y="990.2769">get_unids_listening_to_uiid()</text><polygon fill="#A80036" points="311.5,1021.3999,321.5,1025.3999,311.5,1029.3999,315.5,1025.3999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="94.5" x2="317.5" y1="1025.3999" y2="1025.3999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="101.5" y="1019.8769">list of unids listening to the uiid</text><path d="M20,1040.3999 L93,1040.3999 L93,1047.3999 L83,1057.3999 L20,1057.3999 L20,1040.3999 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="510" style="stroke:#000000;stroke-width:2.0;" width="781" x="20" y="1040.3999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="35" y="1053.4769">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="157" x="108" y="1052.6188">[for all unids listening to uiid]</text><polygon fill="#A80036" points="568.5,1075.5999,578.5,1079.5999,568.5,1083.5999,572.5,1079.5999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="574.5" y1="1079.5999" y2="1079.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="330.5" y="1074.0769">image_available_callback(meta_info)</text><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="821" x="0" y="1108.3999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="821" y1="1108.3999" y2="1108.3999"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="821" y1="1111.3999" y2="1111.3999"/><rect fill="#EEEEEE" filter="url(#f1cdms72lzbec7)" height="23.6" style="stroke:#000000;stroke-width:2.0;" width="121" x="350" y="1097.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="103" x="356" y="1113.6769">image download</text><polygon fill="#A80036" points="334.5,1148.7999,324.5,1152.7999,334.5,1156.7999,330.5,1152.7999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="328.5" x2="579.5" y1="1152.7999" y2="1152.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="340.5" y="1147.2769">get_by_unid(unid, uiid, image_ready_cb)</text><path d="M30,1167.7999 L90,1167.7999 L90,1174.7999 L80,1184.7999 L30,1184.7999 L30,1167.7999 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="375.6" style="stroke:#000000;stroke-width:2.0;" width="761" x="30" y="1167.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="45" y="1180.877">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="102" x="105" y="1180.0189">[image not cached]</text><polygon fill="#A80036" points="702,1203,712,1207,702,1211,706,1207" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="1207" y2="1207"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="330.5" y="1201.477">Subscribe: ucl/OTA/data/uiid/all</text><polygon fill="#A80036" points="702,1232.6,712,1236.6,702,1240.6,706,1236.6" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="1236.6" y2="1236.6"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="330.5" y="1231.077">Publish: ucl/OTA/info/uiid/all/get</text><path d="M40,1251.6 L100,1251.6 L100,1258.6 L90,1268.6 L40,1268.6 L40,1251.6 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="151.2" style="stroke:#000000;stroke-width:2.0;" width="741" x="40" y="1251.6"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="55" y="1264.677">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="87" x="115" y="1263.8189">[image received]</text><polygon fill="#A80036" points="334.5,1286.8,324.5,1290.8,334.5,1294.8,330.5,1290.8" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="328.5" x2="713" y1="1290.8" y2="1290.8"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="340.5" y="1285.277">image file data message</text><polygon fill="#A80036" points="105.5,1316.4,95.5,1320.4,105.5,1324.4,101.5,1320.4" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="322.5" y1="1320.4" y2="1320.4"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="111.5" y="1314.877">cache image file</text><polygon fill="#A80036" points="568.5,1346,578.5,1350,568.5,1354,572.5,1350" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="574.5" y1="1350" y2="1350"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="330.5" y="1344.477">image_ready_cb(OK, filepath)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="40" x2="781" y1="1359" y2="1359"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="104" x="45" y="1369.219">[no image received]</text><polygon fill="#A80036" points="568.5,1390.8,578.5,1394.8,568.5,1398.8,572.5,1394.8" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="574.5" y1="1394.8" y2="1394.8"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="330.5" y="1389.277">image_ready_cb(ERROR, "")</text><polygon fill="#A80036" points="702,1427.4,712,1431.4,702,1435.4,706,1431.4" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="1431.4" y2="1431.4"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="330.5" y="1425.877">Unsubscribe: ucl/OTA/data/uiid/all</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30" x2="791" y1="1440.4" y2="1440.4"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81" x="35" y="1450.6189">[image cached]</text><polygon fill="#A80036" points="105.5,1472.1999,95.5,1476.1999,105.5,1480.1999,101.5,1476.1999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="322.5" y1="1476.1999" y2="1476.1999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="111.5" y="1470.6769">get image filepath from cache</text><polygon fill="#A80036" points="311.5,1501.7999,321.5,1505.7999,311.5,1509.7999,315.5,1505.7999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="94.5" x2="317.5" y1="1505.7999" y2="1505.7999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="101.5" y="1500.2769">image filepath</text><polygon fill="#A80036" points="568.5,1531.3999,578.5,1535.3999,568.5,1539.3999,572.5,1535.3999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="574.5" y1="1535.3999" y2="1535.3999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="330.5" y="1529.8769">image_ready_cb(OK, filepath)</text><polygon fill="#A80036" points="334.5,1581.9999,324.5,1585.9999,334.5,1589.9999,330.5,1585.9999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="328.5" x2="579.5" y1="1585.9999" y2="1585.9999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="340.5" y="1580.4769">unsubscribe_unid(unid, uiid)</text><polygon fill="#A80036" points="105.5,1611.5999,95.5,1615.5999,105.5,1619.5999,101.5,1615.5999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="322.5" y1="1615.5999" y2="1615.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="111.5" y="1610.0769">remove unid listening to uiid</text><polygon fill="#A80036" points="702,1641.2,712,1645.2,702,1649.2,706,1645.2" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="1645.2" y2="1645.2"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="330.5" y="1639.677">Unsubscribe: ucl/OTA/info/uiid/unid</text><path d="M277,1660.2 L337,1660.2 L337,1667.2 L327,1677.2 L277,1677.2 L277,1660.2 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="47.2" style="stroke:#000000;stroke-width:2.0;" width="504" x="277" y="1660.2"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="292" y="1673.277">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="181" x="352" y="1672.4189">[If no more unids listening to uiid]</text><polygon fill="#A80036" points="702,1695.4,712,1699.4,702,1703.4,706,1699.4" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="323.5" x2="708" y1="1699.4" y2="1699.4"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="194" x="330.5" y="1693.877">Unsubscribe: ucl/OTA/info/uiid/all</text><!--MD5=[9b660f4dfb9e2ed3829e6755af139f0b]
@startuml ota_internal.svg
title OTA download from image provider

participant "OTA cache" as OTAC
participant "OTA API" as API
participant "Protocol controller" as PC
participant "Image provider" as IP

PC -> API: subscribe_unid(unid, uiid)

alt If no unids listening to uiid
API -> IP: Subscribe: ucl/OTA/info/uiid/all
end
API -> IP: Subscribe: ucl/OTA/info/uiid/unid
API -> OTAC: unid listening to uiid
alt #LightBlue specific unid available
== image availability ==
IP -> API: Publish: ucl/OTA/info/uiid/unid
API -> OTAC: Cache image meta info for uiid/unid
API -> PC: image_available_callback(meta_info)
== image download ==
PC -> API: get_by_unid(unid, uiid, image_ready_cb)
alt #LightBlue image not cached
API -> IP: Subscribe: ucl/OTA/data/uiid/unid
API -> IP: Publish: ucl/OTA/info/uiid/unid/get
alt #LightBlue image received
IP -> API: Publish: image file data message
API -> OTAC: Cache image file
API -> PC: image_ready_cb(OK, filepath)
else no image received
API -> PC: image_ready_cb(ERROR, "")
end
API -> IP: Unsubscribe: ucl/OTA/data/uiid/unid
else #LightBlue image cached
API -> OTAC: get image filepath from cache
OTAC -> API: image filepath
API -> PC: image_ready_cb(OK, filepath)
end

else #LightGreen no specific unid available
== image availability ==
IP -> API: Publish: ucl/OTA/info/uiid/all
API -> OTAC: Cache image meta info for uiid/all
API -> OTAC: get_unids_listening_to_uiid()
OTAC -> API: list of unids listening to the uiid
loop #LightGreen for all unids listening to uiid
API -> PC: image_available_callback(meta_info)
== image download ==
PC -> API: get_by_unid(unid, uiid, image_ready_cb)
alt #LightGreen image not cached
API -> IP: Subscribe: ucl/OTA/data/uiid/all
API -> IP: Publish: ucl/OTA/info/uiid/all/get
alt #LightGreen image received
IP -> API: image file data message
API -> OTAC: cache image file
API -> PC: image_ready_cb(OK, filepath)
else #LightGreen no image received
API -> PC: image_ready_cb(ERROR, "")
end
API -> IP: Unsubscribe: ucl/OTA/data/uiid/all
else #LightGreen image cached
API -> OTAC: get image filepath from cache
OTAC -> API: image filepath
API -> PC: image_ready_cb(OK, filepath)
end
end
end
PC -> API: unsubscribe_unid(unid, uiid)
API -> OTAC: remove unid listening to uiid
API -> IP: Unsubscribe: ucl/OTA/info/uiid/unid
alt If no more unids listening to uiid
API -> IP: Unsubscribe: ucl/OTA/info/uiid/all
end
@enduml

PlantUML version 1.2022.0(Tue Jan 11 16:16:42 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>