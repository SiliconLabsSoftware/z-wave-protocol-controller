<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1422px" preserveAspectRatio="none" style="width:1517px;height:1422px;background:#FFFFFF;" version="1.1" viewBox="0 0 1517 1422" width="1517px" zoomAndPan="magnify"><defs><filter height="300%" id="f8cev5p0qxbpe" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f8cev5p0qxbpe)" height="161.6001" style="stroke:#000000;stroke-width:2.0;" width="934" x="465.5" y="240.5998"/><rect fill="#FFFFFF" filter="url(#f8cev5p0qxbpe)" height="91.9999" style="stroke:#000000;stroke-width:2.0;" width="489" x="1014.5" y="1121.9502"/><rect fill="#FFFFFF" height="44.7999" style="stroke:none;stroke-width:1.0;" width="489" x="1014.5" y="1169.1502"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="146" y1="40.7999" y2="50.7999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="146" x2="146" y1="50.7999" y2="91.9998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="146" y1="91.9998" y2="121.5998"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="146" x2="146" y1="121.5998" y2="162.7997"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="146" y1="162.7997" y2="409.1999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="146" x2="146" y1="409.1999" y2="450.3998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="146" y1="450.3998" y2="1378.5002"/><line style="stroke:#A80036;stroke-width:1.0;" x1="527.5" x2="527.5" y1="40.7999" y2="50.7999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="527.5" x2="527.5" y1="50.7999" y2="91.9998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="527.5" x2="527.5" y1="91.9998" y2="121.5998"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="527.5" x2="527.5" y1="121.5998" y2="162.7997"/><line style="stroke:#A80036;stroke-width:1.0;" x1="527.5" x2="527.5" y1="162.7997" y2="409.1999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="527.5" x2="527.5" y1="409.1999" y2="450.3998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="527.5" x2="527.5" y1="450.3998" y2="1378.5002"/><line style="stroke:#A80036;stroke-width:1.0;" x1="653.5" x2="653.5" y1="40.7999" y2="50.7999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="653.5" x2="653.5" y1="50.7999" y2="91.9998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="653.5" x2="653.5" y1="91.9998" y2="121.5998"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="653.5" x2="653.5" y1="121.5998" y2="162.7997"/><line style="stroke:#A80036;stroke-width:1.0;" x1="653.5" x2="653.5" y1="162.7997" y2="409.1999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="653.5" x2="653.5" y1="409.1999" y2="450.3998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="653.5" x2="653.5" y1="450.3998" y2="1378.5002"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1107.5" x2="1107.5" y1="40.7999" y2="50.7999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1107.5" x2="1107.5" y1="50.7999" y2="91.9998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1107.5" x2="1107.5" y1="91.9998" y2="121.5998"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1107.5" x2="1107.5" y1="121.5998" y2="162.7997"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1107.5" x2="1107.5" y1="162.7997" y2="409.1999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1107.5" x2="1107.5" y1="409.1999" y2="450.3998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1107.5" x2="1107.5" y1="450.3998" y2="1378.5002"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1295.5" x2="1295.5" y1="40.7999" y2="50.7999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1295.5" x2="1295.5" y1="50.7999" y2="91.9998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1295.5" x2="1295.5" y1="91.9998" y2="121.5998"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1295.5" x2="1295.5" y1="121.5998" y2="162.7997"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1295.5" x2="1295.5" y1="162.7997" y2="409.1999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1295.5" x2="1295.5" y1="409.1999" y2="450.3998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1295.5" x2="1295.5" y1="450.3998" y2="1378.5002"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1446.5" x2="1446.5" y1="40.7999" y2="50.7999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1446.5" x2="1446.5" y1="50.7999" y2="91.9998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1446.5" x2="1446.5" y1="91.9998" y2="121.5998"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1446.5" x2="1446.5" y1="121.5998" y2="162.7997"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1446.5" x2="1446.5" y1="162.7997" y2="409.1999"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1446.5" x2="1446.5" y1="409.1999" y2="450.3998"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1446.5" x2="1446.5" y1="450.3998" y2="1378.5002"/><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="82" x="103" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="110" y="25.0059">SomeTask</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="82" x="103" y="1377.5002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="110" y="1397.5061">SomeTask</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="101" x="475.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="482.5" y="25.0059">AttributeStore</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="101" x="475.5" y="1377.5002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="482.5" y="1397.5061">AttributeStore</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="123" x="590.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="597.5" y="25.0059">AttributeResolver</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="123" x="590.5" y="1377.5002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="597.5" y="1397.5061">AttributeResolver</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="163" x="1024.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="1031.5" y="25.0059">AttributeResolverGroup</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="163" x="1024.5" y="1377.5002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="149" x="1031.5" y="1397.5061">AttributeResolverGroup</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="184" x="1201.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="1208.5" y="25.0059">Z-Wave CommandClasses</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="184" x="1201.5" y="1377.5002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="1208.5" y="1397.5061">Z-Wave CommandClasses</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="90" x="1399.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="1406.5" y="25.0059">Z-Wave API</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="30.7999" style="stroke:#A80036;stroke-width:1.5;" width="90" x="1399.5" y="1377.5002"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="1406.5" y="1397.5061">Z-Wave API</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="14" x="789.25" y="75.0189">Init</text><polygon fill="#A80036" points="665,109.5998,655,113.5998,665,117.5998,661,113.5998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="659" x2="1107" y1="113.5998" y2="113.5998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="430" x="671" y="108.0768">attribute_resolver_register_set_rule_listener(&amp;on_new_set_rule_registered)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="747.25" y="145.8188">Command Class Init</text><path d="M1149,167.7997 L1149,223.7997 L1438,223.7997 L1438,177.7997 L1428,167.7997 L1149,167.7997 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1428,167.7997 L1428,177.7997 L1438,177.7997 L1428,167.7997 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="1155" y="184.8768">Each CC will register rules on Desired Z-Wave</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="228" x="1155" y="200.4768">attributes, in this example only one rule</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1155" y="216.0768">registration is shown.</text><path d="M465.5,240.5998 L538.5,240.5998 L538.5,247.5998 L528.5,257.5998 L465.5,257.5998 L465.5,240.5998 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="161.6001" style="stroke:#000000;stroke-width:2.0;" width="934" x="465.5" y="240.5998"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="480.5" y="253.6768">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="356" x="553.5" y="252.8187">[For each registered rule from the Z-Wave Command Class handler]</text><polygon fill="#A80036" points="665,275.7998,655,279.7998,665,283.7998,661,279.7998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="659" x2="1294.5" y1="279.7998" y2="279.7998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="671" y="274.2768">attribute_resolver_register_rule(...)</text><polygon fill="#A80036" points="1096,305.3998,1106,309.3998,1096,313.3998,1100,309.3998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654" x2="1102" y1="309.3998" y2="309.3998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="661" y="303.8768">on_new_set_rule_registered(...)</text><polygon fill="#A80036" points="539,334.9998,529,338.9998,539,342.9998,535,338.9998" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="533" x2="1107" y1="338.9998" y2="338.9998"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="500" x="545" y="333.4768">attribute_store_register_callback_by_type_and_state(on_settable_attribute_update, ...)</text><path d="M956,351.9998 L956,392.9998 L1256,392.9998 L1256,361.9998 L1246,351.9998 L956,351.9998 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1246,351.9998 L1246,361.9998 L1256,361.9998 L1246,351.9998 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="962" y="369.0769">Attribute Resolver Group registers a callback for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="962" y="384.6769">when the attribute value is set.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="98" x="747.25" y="433.4188">Desired attribute set</text><path d="M5,455.3998 L5,558.3998 L283,558.3998 L283,465.3998 L273,455.3998 L5,455.3998 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M273,455.3998 L273,465.3998 L283,465.3998 L273,455.3998 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="11" y="472.4768">Task sets a number of attributes. This could</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="11" y="488.0768">e.g. be a command for a ZCL group. In this</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="11" y="503.6768">example the task will set the same desired</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="11" y="519.2768">value for the same attribute type on 2 nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="11" y="534.8768">(could e.g. be On to a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="11" y="550.4768">binary switch).</text><polygon fill="#A80036" points="516,585.5999,526,589.5999,516,593.5999,520,589.5999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="522" y1="589.5999" y2="589.5999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="153" y="584.0769">attribute_store_set_node_attribute_value(1, DESIRED, ON, 1)</text><polygon fill="#A80036" points="1096,615.1999,1106,619.1999,1096,623.1999,1100,619.1999" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="528" x2="1102" y1="619.1999" y2="619.1999"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="535" y="613.6769">on_settable_attribute_update(...)</text><path d="M977,632.1999 L977,675.1999 L1235,675.1999 L1235,642.1999 L1225,632.1999 L977,632.1999 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1225,632.1999 L1225,642.1999 L1235,642.1999 L1225,632.1999 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="983" y="649.2769">Attribute Group Resolver stores the node</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="983" y="666.8269">in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="123" x="1019" y="667.0999">multicast_candidates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="1146" y="666.8269">list</text><polygon fill="#A80036" points="516,701.9499,526,705.9499,516,709.9499,520,705.9499" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="146" x2="522" y1="705.9499" y2="705.9499"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="358" x="153" y="700.4269">attribute_store_set_node_attribute_value(2, DESIRED, ON, 1)</text><polygon fill="#A80036" points="1096,731.5499,1106,735.5499,1096,739.5499,1100,735.5499" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="528" x2="1102" y1="735.5499" y2="735.5499"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="535" y="730.0269">on_settable_attribute_update(...)</text><path d="M977,748.5499 L977,791.5499 L1235,791.5499 L1235,758.5499 L1225,748.5499 L977,748.5499 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1225,748.5499 L1225,758.5499 L1235,758.5499 L1225,748.5499 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="237" x="983" y="765.6269">Attribute Group Resolver stores the node</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="32" x="983" y="783.177">in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="123" x="1019" y="783.45">multicast_candidates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="1146" y="783.177">list</text><path d="M521,805.7 L521,881.7 L783,881.7 L783,815.7 L773,805.7 L521,805.7 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M773,805.7 L773,815.7 L783,815.7 L773,805.7 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="527" y="822.777">Attribute Resolver will on its next scan</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="527" y="838.377">detect the Desired attribute changes and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="20" x="527" y="855.927">call</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="143" x="551" y="856.2">attribute_resolver_send()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="694" y="855.927">, which</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="527" y="873.477">calls</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="210" x="558" y="873.75">zpc_attribute_resolver_send_group()</text><polygon fill="#A80036" points="1096,908.6,1106,912.6,1096,916.6,1100,912.6" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654" x2="1102" y1="912.6" y2="912.6"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="661" y="907.077">zpc_attribute_resolver_send_group(1)</text><path d="M968,925.6 L968,1046.6 L1243,1046.6 L1243,935.6 L1233,925.6 L968,925.6 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1233,925.6 L1233,935.6 L1243,935.6 L1233,925.6 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="974" y="942.677">Attribute Store Group will loop through the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="123" x="974" y="960.5001">multicast_candidates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="1101" y="960.2271">list and find the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="974" y="975.8271">desired attributes, that can be multicasted.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="974" y="991.4271">Each attribute, that can be multicasted over</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252" x="974" y="1007.0271">Z-Wave will be sent here, and the attributes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="243" x="974" y="1022.6271">will be marked added to the attribute store</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="974" y="1038.2271">resolution list.</text><polygon fill="#A80036" points="1434.5,1073.3501,1444.5,1077.3501,1434.5,1081.3501,1438.5,1077.3501" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1108" x2="1440.5" y1="1077.3501" y2="1077.3501"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="1115" y="1071.8271">zwave_tx_assign_group(...)</text><polygon fill="#A80036" points="1434.5,1102.9502,1444.5,1106.9502,1434.5,1110.9502,1438.5,1106.9502" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1108" x2="1440.5" y1="1106.9502" y2="1106.9502"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255" x="1115" y="1101.4272">zwave_tx_scheme_get_node_tx_options(...)</text><path d="M1014.5,1121.9502 L1074.5,1121.9502 L1074.5,1128.9502 L1064.5,1138.9502 L1014.5,1138.9502 L1014.5,1121.9502 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="91.9999" style="stroke:#000000;stroke-width:2.0;" width="489" x="1014.5" y="1121.9502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="15" x="1029.5" y="1135.0272">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70" x="1089.5" y="1134.1691">[supervision]</text><polygon fill="#A80036" points="1434.5,1157.1502,1444.5,1161.1502,1434.5,1165.1502,1438.5,1161.1502" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1108" x2="1440.5" y1="1161.1502" y2="1161.1502"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="1115" y="1155.6272">zwave_command_class_supervision_send_data(...)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1014.5" x2="1503.5" y1="1170.1502" y2="1170.1502"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="87" x="1019.5" y="1180.3691">[no supervision]</text><polygon fill="#A80036" points="1434.5,1201.9501,1444.5,1205.9501,1434.5,1209.9501,1438.5,1205.9501" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1108" x2="1440.5" y1="1205.9501" y2="1205.9501"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="1115" y="1200.4271">zwave_tx_send_data(...)</text><polygon fill="#A80036" points="665,1238.5501,655,1242.5501,665,1246.5501,661,1242.5501" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="659" x2="1107" y1="1242.5501" y2="1242.5501"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="330" x="671" y="1237.0271">attribute_resolver_associate_node_with_tx_sessions_id()</text><polygon fill="#A80036" points="1096,1268.1501,1106,1272.1501,1096,1276.1501,1100,1272.1501" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="654" x2="1102" y1="1272.1501" y2="1272.1501"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="661" y="1266.6271">zpc_attribute_resolver_send_group(2)</text><path d="M962,1285.1501 L962,1359.1501 L1249,1359.1501 L1249,1295.1501 L1239,1285.1501 L962,1285.1501 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1239,1285.1501 L1239,1295.1501 L1249,1295.1501 L1239,1285.1501 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="266" x="968" y="1302.2271">When the attribute resolver calls the 2nd send</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="968" y="1317.8272">the attribute is already sent as a multicast,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43" x="968" y="1335.3772">and the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="210" x="1015" y="1335.6502">zpc_attribute_resolver_send_group()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="968" y="1350.9772">function will return immediately.</text><!--MD5=[5c1bb801930762745b8475fb856cbc2b]
@startuml zwave_multicast.svg
participant SomeTask as t1
participant AttributeStore as as
participant AttributeResolver as ar
participant AttributeResolverGroup as ag
participant "Z-Wave CommandClasses" as cc
participant "Z-Wave API" as zw

... Init ...
ag -> ar : attribute_resolver_register_set_rule_listener(&on_new_set_rule_registered)

... Command Class Init ...
note over cc
    Each CC will register rules on Desired Z-Wave
    attributes, in this example only one rule
    registration is shown.
end note
loop For each registered rule from the Z-Wave Command Class handler
    cc -> ar : attribute_resolver_register_rule(...)
    ar -> ag : on_new_set_rule_registered(...)
    ag -> as : attribute_store_register_callback_by_type_and_state(on_settable_attribute_update, ...)
    note over ag
        Attribute Resolver Group registers a callback for
        when the attribute value is set.
    end note
end

... Desired attribute set ...
note over t1
    Task sets a number of attributes. This could
    e.g. be a command for a ZCL group. In this
    example the task will set the same desired
    value for the same attribute type on 2 nodes
    (could e.g. be On to a
    binary switch).
end note

t1 -> as : attribute_store_set_node_attribute_value(1, DESIRED, ON, 1)
as -> ag : on_settable_attribute_update(...)
note over ag
    Attribute Group Resolver stores the node
    in the <i>multicast_candidates</i> list
end note
t1 -> as : attribute_store_set_node_attribute_value(2, DESIRED, ON, 1)
as -> ag : on_settable_attribute_update(...)
note over ag
    Attribute Group Resolver stores the node
    in the <i>multicast_candidates</i> list
end note

note over ar
    Attribute Resolver will on its next scan
    detect the Desired attribute changes and
    call <i>attribute_resolver_send()</i>, which
    calls <i>zpc_attribute_resolver_send_group()</i>
end note
ar -> ag : zpc_attribute_resolver_send_group(1)
note over ag
    Attribute Store Group will loop through the
    <i>multicast_candidates</i> list and find the
    desired attributes, that can be multicasted.
    Each attribute, that can be multicasted over
    Z-Wave will be sent here, and the attributes
    will be marked added to the attribute store
    resolution list.
end note
ag -> zw : zwave_tx_assign_group(...)
ag -> zw : zwave_tx_scheme_get_node_tx_options(...)
alt supervision
    ag -> zw : zwave_command_class_supervision_send_data(...)
else no supervision
    ag -> zw : zwave_tx_send_data(...)
end
ag -> ar : attribute_resolver_associate_node_with_tx_sessions_id()

ar -> ag : zpc_attribute_resolver_send_group(2)
note over ag
    When the attribute resolver calls the 2nd send
    the attribute is already sent as a multicast,
    and the <i>zpc_attribute_resolver_send_group()</i>
    function will return immediately.
end note
@enduml

PlantUML version 1.2022.0(Tue Jan 11 16:16:42 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>