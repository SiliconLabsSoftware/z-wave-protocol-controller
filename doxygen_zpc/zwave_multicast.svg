<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1521px" preserveAspectRatio="none" style="width:1553px;height:1521px;background:#FFFFFF;" version="1.1" viewBox="0 0 1553 1521" width="1553px" zoomAndPan="magnify"><defs><filter height="300%" id="f8cev5p0qxbpe" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f8cev5p0qxbpe)" height="174.2361" style="stroke:#000000;stroke-width:2.0;" width="970" x="466" y="254.8558"/><rect fill="#FFFFFF" filter="url(#f8cev5p0qxbpe)" height="100.0999" style="stroke:#000000;stroke-width:2.0;" width="500" x="1039" y="1199.8422"/><rect fill="#FFFFFF" height="48.6879" style="stroke:none;stroke-width:1.0;" width="500" x="1039" y="1251.2542"/><line style="stroke:#A80036;stroke-width:1.0;" x1="149" x2="149" y1="43.0679" y2="53.0679"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="149" x2="149" y1="53.0679" y2="96.0498"/><line style="stroke:#A80036;stroke-width:1.0;" x1="149" x2="149" y1="96.0498" y2="127.7558"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="149" x2="149" y1="127.7558" y2="170.7377"/><line style="stroke:#A80036;stroke-width:1.0;" x1="149" x2="149" y1="170.7377" y2="436.0919"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="149" x2="149" y1="436.0919" y2="479.0737"/><line style="stroke:#A80036;stroke-width:1.0;" x1="149" x2="149" y1="479.0737" y2="1475.1782"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532" x2="532" y1="43.0679" y2="53.0679"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="532" x2="532" y1="53.0679" y2="96.0498"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532" x2="532" y1="96.0498" y2="127.7558"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="532" x2="532" y1="127.7558" y2="170.7377"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532" x2="532" y1="170.7377" y2="436.0919"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="532" x2="532" y1="436.0919" y2="479.0737"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532" x2="532" y1="479.0737" y2="1475.1782"/><line style="stroke:#A80036;stroke-width:1.0;" x1="666" x2="666" y1="43.0679" y2="53.0679"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="666" x2="666" y1="53.0679" y2="96.0498"/><line style="stroke:#A80036;stroke-width:1.0;" x1="666" x2="666" y1="96.0498" y2="127.7558"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="666" x2="666" y1="127.7558" y2="170.7377"/><line style="stroke:#A80036;stroke-width:1.0;" x1="666" x2="666" y1="170.7377" y2="436.0919"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="666" x2="666" y1="436.0919" y2="479.0737"/><line style="stroke:#A80036;stroke-width:1.0;" x1="666" x2="666" y1="479.0737" y2="1475.1782"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1137" x2="1137" y1="43.0679" y2="53.0679"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1137" x2="1137" y1="53.0679" y2="96.0498"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1137" x2="1137" y1="96.0498" y2="127.7558"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1137" x2="1137" y1="127.7558" y2="170.7377"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1137" x2="1137" y1="170.7377" y2="436.0919"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1137" x2="1137" y1="436.0919" y2="479.0737"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1137" x2="1137" y1="479.0737" y2="1475.1782"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1331" x2="1331" y1="43.0679" y2="53.0679"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1331" x2="1331" y1="53.0679" y2="96.0498"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1331" x2="1331" y1="96.0498" y2="127.7558"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1331" x2="1331" y1="127.7558" y2="170.7377"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1331" x2="1331" y1="170.7377" y2="436.0919"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1331" x2="1331" y1="436.0919" y2="479.0737"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1331" x2="1331" y1="479.0737" y2="1475.1782"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1482" x2="1482" y1="43.0679" y2="53.0679"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1482" x2="1482" y1="53.0679" y2="96.0498"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1482" x2="1482" y1="96.0498" y2="127.7558"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1482" x2="1482" y1="127.7558" y2="170.7377"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1482" x2="1482" y1="170.7377" y2="436.0919"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1482" x2="1482" y1="436.0919" y2="479.0737"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1482" x2="1482" y1="479.0737" y2="1475.1782"/><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="81" x="107" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="114" y="26.9659">SomeTask</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="81" x="107" y="1474.1782"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="114" y="1496.1442">SomeTask</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="109" x="476" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="483" y="26.9659">AttributeStore</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="109" x="476" y="1474.1782"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="483" y="1496.1442">AttributeStore</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="131" x="599" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="606" y="26.9659">AttributeResolver</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="131" x="599" y="1474.1782"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="606" y="1496.1442">AttributeResolver</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="173" x="1049" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159" x="1056" y="26.9659">AttributeResolverGroup</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="173" x="1049" y="1474.1782"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159" x="1056" y="1496.1442">AttributeResolverGroup</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="186" x="1236" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="1243" y="26.9659">Z-Wave CommandClasses</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="186" x="1236" y="1474.1782"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="172" x="1243" y="1496.1442">Z-Wave CommandClasses</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="89" x="1436" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="1443" y="26.9659">Z-Wave API</text><rect fill="#FEFECE" filter="url(#f8cev5p0qxbpe)" height="33.0679" style="stroke:#A80036;stroke-width:1.5;" width="89" x="1436" y="1474.1782"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="1443" y="1496.1442">Z-Wave API</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="807" y="78.8268">Init</text><polygon fill="#A80036" points="677.5,115.7558,667.5,119.7558,677.5,123.7558,673.5,119.7558" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="671.5" x2="1136.5" y1="119.7558" y2="119.7558"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="447" x="683.5" y="113.9468">attribute_resolver_register_set_rule_listener(&amp;on_new_set_rule_registered)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="104" x="764" y="153.5147">Command Class Init</text><path d="M1186,175.7377 L1186,238.7377 L1471,238.7377 L1471,185.7377 L1461,175.7377 L1186,175.7377 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1461,175.7377 L1461,185.7377 L1471,185.7377 L1461,175.7377 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="264" x="1192" y="194.6347">Each CC will register rules on Desired Z-Wave</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="1192" y="212.3407">attributes, in this example only one rule</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="1192" y="230.0468">registration is shown.</text><path d="M466,254.8558 L539,254.8558 L539,263.8558 L529,273.8558 L466,273.8558 L466,254.8558 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="174.2361" style="stroke:#000000;stroke-width:2.0;" width="970" x="466" y="254.8558"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="481" y="269.7528">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="374" x="554" y="268.6147">[For each registered rule from the Z-Wave Command Class handler]</text><polygon fill="#A80036" points="677.5,294.2678,667.5,298.2678,677.5,302.2678,673.5,298.2678" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="671.5" x2="1330" y1="298.2678" y2="298.2678"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="683.5" y="292.4588">attribute_resolver_register_rule(...)</text><polygon fill="#A80036" points="1125.5,325.9738,1135.5,329.9738,1125.5,333.9738,1129.5,329.9738" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="666.5" x2="1131.5" y1="329.9738" y2="329.9738"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="673.5" y="324.1648">on_new_set_rule_registered(...)</text><polygon fill="#A80036" points="543.5,357.6798,533.5,361.6798,543.5,365.6798,539.5,361.6798" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="537.5" x2="1136.5" y1="361.6798" y2="361.6798"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="515" x="549.5" y="355.8708">attribute_store_register_callback_by_type_and_state(on_settable_attribute_update, ...)</text><path d="M983,374.6798 L983,419.6798 L1288,419.6798 L1288,384.6798 L1278,374.6798 L983,374.6798 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1278,374.6798 L1278,384.6798 L1288,384.6798 L1278,374.6798 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="284" x="989" y="393.5768">Attribute Resolver Group registers a callback for</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183" x="989" y="411.2829">when the attribute value is set.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="107" x="762.5" y="461.8508">Desired attribute set</text><path d="M5,484.0737 L5,600.0737 L291,600.0737 L291,494.0737 L281,484.0737 L5,484.0737 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M281,484.0737 L281,494.0737 L291,494.0737 L281,484.0737 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="11" y="502.9708">Task sets a number of attributes. This could</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="11" y="520.6768">e.g. be a command for a ZCL group. In this</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250" x="11" y="538.3828">example the task will set the same desired</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265" x="11" y="556.0888">value for the same attribute type on 2 nodes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="11" y="573.7948">(could e.g. be On to a</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="11" y="591.5008">binary switch).</text><polygon fill="#A80036" points="520.5,629.0159,530.5,633.0159,520.5,637.0159,524.5,633.0159" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="149.5" x2="526.5" y1="633.0159" y2="633.0159"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359" x="156.5" y="627.2069">attribute_store_set_node_attribute_value(1, DESIRED, ON, 1)</text><polygon fill="#A80036" points="1125.5,660.7219,1135.5,664.7219,1125.5,668.7219,1129.5,664.7219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532.5" x2="1131.5" y1="664.7219" y2="664.7219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="539.5" y="658.9129">on_settable_attribute_update(...)</text><path d="M1002,677.7219 L1002,722.7219 L1269,722.7219 L1269,687.7219 L1259,677.7219 L1002,677.7219 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1259,677.7219 L1259,687.7219 L1269,687.7219 L1259,677.7219 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="1008" y="696.6189">Attribute Group Resolver stores the node</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="1008" y="714.3249">in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="120" x="1045" y="714.3249">multicast_candidates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="1168" y="714.3249">list</text><polygon fill="#A80036" points="520.5,751.8399,530.5,755.8399,520.5,759.8399,524.5,755.8399" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="149.5" x2="526.5" y1="755.8399" y2="755.8399"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="359" x="156.5" y="750.0309">attribute_store_set_node_attribute_value(2, DESIRED, ON, 1)</text><polygon fill="#A80036" points="1125.5,783.5459,1135.5,787.5459,1125.5,791.5459,1129.5,787.5459" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="532.5" x2="1131.5" y1="787.5459" y2="787.5459"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="539.5" y="781.7369">on_settable_attribute_update(...)</text><path d="M1002,800.5459 L1002,845.5459 L1269,845.5459 L1269,810.5459 L1259,800.5459 L1002,800.5459 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1259,800.5459 L1259,810.5459 L1269,810.5459 L1259,800.5459 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="1008" y="819.443">Attribute Group Resolver stores the node</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="1008" y="837.149">in the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="120" x="1045" y="837.149">multicast_candidates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="17" x="1168" y="837.149">list</text><path d="M532,859.958 L532,939.958 L797,939.958 L797,869.958 L787,859.958 L532,859.958 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M787,859.958 L787,869.958 L797,869.958 L787,859.958 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="538" y="878.855">Attribute Resolver will on its next scan</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="538" y="896.561">detect the Desired attribute changes and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="19" x="538" y="914.267">call</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="139" x="560" y="914.267">attribute_resolver_send()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="699" y="914.267">, which</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25" x="538" y="931.973">calls</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="205" x="566" y="931.973">zpc_attribute_resolver_send_group()</text><polygon fill="#A80036" points="1125.5,969.4881,1135.5,973.4881,1125.5,977.4881,1129.5,973.4881" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="666.5" x2="1131.5" y1="973.4881" y2="973.4881"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="673.5" y="967.6791">zpc_attribute_resolver_send_group(1)</text><path d="M995,986.4881 L995,1119.4881 L1276,1119.4881 L1276,996.4881 L1266,986.4881 L995,986.4881 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1266,986.4881 L1266,996.4881 L1276,996.4881 L1266,986.4881 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="1001" y="1005.3851">Attribute Store Group will loop through the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="120" x="1001" y="1023.0911">multicast_candidates</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="1124" y="1023.0911">list and find the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="255" x="1001" y="1040.7971">desired attributes, that can be multicasted.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="1001" y="1058.5031">Each attribute, that can be multicasted over</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="1001" y="1076.2091">Z-Wave will be sent here, and the attributes</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256" x="1001" y="1093.9152">will be marked added to the attribute store</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="1001" y="1111.6212">resolution list.</text><polygon fill="#A80036" points="1470.5,1149.1362,1480.5,1153.1362,1470.5,1157.1362,1474.5,1153.1362" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1137.5" x2="1476.5" y1="1153.1362" y2="1153.1362"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="1144.5" y="1147.3272">zwave_tx_assign_group(...)</text><polygon fill="#A80036" points="1470.5,1180.8422,1480.5,1184.8422,1470.5,1188.8422,1474.5,1184.8422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1137.5" x2="1476.5" y1="1184.8422" y2="1184.8422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="257" x="1144.5" y="1179.0332">zwave_tx_scheme_get_node_tx_options(...)</text><path d="M1039,1199.8422 L1102,1199.8422 L1102,1208.8422 L1092,1218.8422 L1039,1218.8422 L1039,1199.8422 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="100.0999" style="stroke:#000000;stroke-width:2.0;" width="500" x="1039" y="1199.8422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="1054" y="1214.7392">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="70" x="1117" y="1213.6011">[supervision]</text><polygon fill="#A80036" points="1470.5,1239.2542,1480.5,1243.2542,1470.5,1247.2542,1474.5,1243.2542" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1137.5" x2="1476.5" y1="1243.2542" y2="1243.2542"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="1144.5" y="1237.4452">zwave_command_class_supervision_send_data(...)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1039" x2="1539" y1="1252.2542" y2="1252.2542"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="87" x="1044" y="1264.0132">[no supervision]</text><polygon fill="#A80036" points="1470.5,1287.9421,1480.5,1291.9421,1470.5,1295.9421,1474.5,1291.9421" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1137.5" x2="1476.5" y1="1291.9421" y2="1291.9421"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="1144.5" y="1286.1331">zwave_tx_send_data(...)</text><polygon fill="#A80036" points="677.5,1326.6482,667.5,1330.6482,677.5,1334.6482,673.5,1330.6482" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="671.5" x2="1136.5" y1="1330.6482" y2="1330.6482"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="336" x="683.5" y="1324.8392">attribute_resolver_associate_node_with_tx_sessions_id()</text><polygon fill="#A80036" points="1125.5,1358.3542,1135.5,1362.3542,1125.5,1366.3542,1129.5,1362.3542" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="666.5" x2="1131.5" y1="1362.3542" y2="1362.3542"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226" x="673.5" y="1356.5452">zpc_attribute_resolver_send_group(2)</text><path d="M988,1375.3542 L988,1455.3542 L1283,1455.3542 L1283,1385.3542 L1273,1375.3542 L988,1375.3542 " fill="#FBFB77" filter="url(#f8cev5p0qxbpe)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1273,1375.3542 L1273,1385.3542 L1283,1385.3542 L1273,1375.3542 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="994" y="1394.2512">When the attribute resolver calls the 2nd send</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="994" y="1411.9572">the attribute is already sent as a multicast,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="994" y="1429.6632">and the</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacing" textLength="205" x="1043" y="1429.6632">zpc_attribute_resolver_send_group()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="994" y="1447.3692">function will return immediately.</text><!--MD5=[8a39c7bc54382e655c65e430399ddb3a]
@startuml zwave_multicast.svg
participant SomeTask as t1
participant AttributeStore as as
participant AttributeResolver as ar
participant AttributeResolverGroup as ag
participant "Z-Wave CommandClasses" as cc
participant "Z-Wave API" as zw

... Init ...
ag -> ar : attribute_resolver_register_set_rule_listener(&on_new_set_rule_registered)

... Command Class Init ...
note over cc
    Each CC will register rules on Desired Z-Wave
    attributes, in this example only one rule
    registration is shown.
end note
loop For each registered rule from the Z-Wave Command Class handler
    cc -> ar : attribute_resolver_register_rule(...)
    ar -> ag : on_new_set_rule_registered(...)
    ag -> as : attribute_store_register_callback_by_type_and_state(on_settable_attribute_update, ...)
    note over ag
        Attribute Resolver Group registers a callback for
        when the attribute value is set.
    end note
end

... Desired attribute set ...
note over t1
    Task sets a number of attributes. This could
    e.g. be a command for a ZCL group. In this
    example the task will set the same desired
    value for the same attribute type on 2 nodes
    (could e.g. be On to a
    binary switch).
end note

t1 -> as : attribute_store_set_node_attribute_value(1, DESIRED, ON, 1)
as -> ag : on_settable_attribute_update(...)
note over ag
    Attribute Group Resolver stores the node
    in the <i>multicast_candidates</i> list
end note
t1 -> as : attribute_store_set_node_attribute_value(2, DESIRED, ON, 1)
as -> ag : on_settable_attribute_update(...)
note over ag
    Attribute Group Resolver stores the node
    in the <i>multicast_candidates</i> list
end note

note over ar
    Attribute Resolver will on its next scan
    detect the Desired attribute changes and
    call <i>attribute_resolver_send()</i>, which
    calls <i>zpc_attribute_resolver_send_group()</i>
end note
ar -> ag : zpc_attribute_resolver_send_group(1)
note over ag
    Attribute Store Group will loop through the
    <i>multicast_candidates</i> list and find the
    desired attributes, that can be multicasted.
    Each attribute, that can be multicasted over
    Z-Wave will be sent here, and the attributes
    will be marked added to the attribute store
    resolution list.
end note
ag -> zw : zwave_tx_assign_group(...)
ag -> zw : zwave_tx_scheme_get_node_tx_options(...)
alt supervision
    ag -> zw : zwave_command_class_supervision_send_data(...)
else no supervision
    ag -> zw : zwave_tx_send_data(...)
end
ag -> ar : attribute_resolver_associate_node_with_tx_sessions_id()

ar -> ag : zpc_attribute_resolver_send_group(2)
note over ag
    When the attribute resolver calls the 2nd send
    the attribute is already sent as a multicast,
    and the <i>zpc_attribute_resolver_send_group()</i>
    function will return immediately.
end note
@enduml

PlantUML version 1.2022.0(Tue Jan 11 17:16:42 CET 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>