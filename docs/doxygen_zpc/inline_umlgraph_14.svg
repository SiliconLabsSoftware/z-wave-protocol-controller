<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1393px" preserveAspectRatio="none" style="width:1202px;height:1393px;background:#FFFFFF;" version="1.1" viewBox="0 0 1202 1393" width="1202px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="36.4001" style="stroke:#FFFFFF;stroke-width:0.0;" width="661" x="274.5" y="10"/><text fill="#000000" font-family="Verdana" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="651" x="279.5" y="35.4381">Z-Wave TX parent frame functionality with transports (example)</text><rect fill="#FFFFFF" height="680.2002" style="stroke:#000000;stroke-width:1.0;" width="909.5" x="286.5" y="476.0001"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="112" x2="112" y1="100.9999" y2="1386.6005"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="349.5" x2="349.5" y1="100.9999" y2="1386.6005"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="657" x2="657" y1="100.9999" y2="1386.6005"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="878.5" x2="878.5" y1="100.9999" y2="1386.6005"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="985.5" x2="985.5" y1="100.9999" y2="1386.6005"/><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1103.5" x2="1103.5" y1="100.9999" y2="1386.6005"/><rect fill="#FFFFFF" height="30.7999" style="stroke:#000000;stroke-width:1.0;" width="119" x="53" y="69.2"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="105" x="60" y="89.206">User component</text><rect fill="#DEDEDE" height="30.7999" style="stroke:#000000;stroke-width:1.0;" width="86" x="306.5" y="69.2"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="72" x="313.5" y="89.206">Z-Wave TX</text><rect fill="#FFFFFF" height="30.7999" style="stroke:#000000;stroke-width:1.0;" width="137" x="589" y="69.2"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="123" x="596" y="89.206">Z-Wave Transports</text><rect fill="#DEDEDE" height="47.5999" style="stroke:#000000;stroke-width:1.0;" width="64" x="846.5" y="52.4001"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="50" x="853.5" y="72.406">Z-Wave</text><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="17" x="870" y="89.206">S2</text><rect fill="#FFFFFF" height="30.7999" style="stroke:#000000;stroke-width:1.0;" width="90" x="940.5" y="69.2"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="76" x="947.5" y="89.206">Z-Wave API</text><rect fill="#DEDEDE" height="30.7999" style="stroke:#000000;stroke-width:1.0;" width="87" x="1060.5" y="69.2"/><text fill="#000000" font-family="Verdana" font-size="14" lengthAdjust="spacing" textLength="73" x="1067.5" y="89.206">Z-Wave RX</text><rect fill="#FFFFFF" height="54" style="stroke:#000000;stroke-width:1.0;" width="98" x="10" y="115.9999"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="84" x="14" y="132.077">I have a frame</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="90" x="14" y="147.677">to be encrypted</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="83" x="14" y="163.277">and then sent.</text><polygon fill="#000000" points="337.5,209,347.5,213,337.5,217,341.5,213" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="112.5" x2="343.5" y1="213" y2="213"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126" x="119.5" y="191.877">zwave_tx_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="213" x="119.5" y="207.477">(frame data, encapsulation=S2 Auth)</text><rect fill="#FFFFFF" height="39" style="stroke:#000000;stroke-width:1.0;" width="207" x="354" y="226"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="358" y="242.077">Queue:</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="58" x="358" y="257.677">- Frame 1</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="141" x="416" y="257.677">: Encapsulation S2 Auth</text><polygon fill="#000000" points="645.5,303.4001,655.5,307.4001,645.5,311.4001,649.5,307.4001" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="349.5" x2="651.5" y1="307.4001" y2="307.4001"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="238" x="356.5" y="286.277">zwave_controller_transport_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118" x="356.5" y="301.8771">(Frame 1, no parent)</text><polygon fill="#000000" points="866.5,348.6001,876.5,352.6001,866.5,356.6001,870.5,352.6001" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="657.5" x2="872.5" y1="352.6001" y2="352.6001"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="129" x="664.5" y="331.4771">zwave_s2_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="118" x="664.5" y="347.0771">(Frame 1, no parent)</text><polygon fill="#000000" points="668.5,378.2001,658.5,382.2001,668.5,386.2001,664.5,382.2001" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="662.5" x2="877.5" y1="382.2001" y2="382.2001"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101" x="674.5" y="376.6771">SL_STATUS_OK</text><polygon fill="#000000" points="360.5,407.8001,350.5,411.8001,360.5,415.8001,356.5,411.8001" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="354.5" x2="656.5" y1="411.8001" y2="411.8001"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101" x="366.5" y="406.2771">SL_STATUS_OK</text><rect fill="#FFFFFF" height="39" style="stroke:#000000;stroke-width:1.0;" width="204" x="354" y="424.8001"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="108" x="358" y="440.8771">Waits that Z-Wave</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196" x="358" y="456.4771">Transports callbacks for Frame 1.</text><path d="M286.5,476.0001 L359.5,476.0001 L359.5,483.0001 L349.5,493.0001 L286.5,493.0001 L286.5,476.0001 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="680.2002" style="stroke:#000000;stroke-width:1.0;" width="909.5" x="286.5" y="476.0001"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="28" x="301.5" y="489.0772">loop</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="221" x="374.5" y="488.2191">[for as many encapsulated frames needed</text><text fill="#000000" font-family="Verdana" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="331" x="374.5" y="501.419">(Nonce Get, Encapsulated frame, etc) to get Frame 1 delivered]</text><polygon fill="#000000" points="360.5,538.2,350.5,542.2,360.5,546.2,356.5,542.2" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="354.5" x2="877.5" y1="542.2" y2="542.2"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126" x="366.5" y="521.077">zwave_tx_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="329" x="366.5" y="536.677">(Frame 2 data, encapsulation = None, Parent = Frame 1)</text><rect fill="#FFFFFF" height="54" style="stroke:#000000;stroke-width:1.0;" width="290" x="354" y="555.2"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="358" y="571.277">Queue:</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="58" x="358" y="586.877">- Frame 1</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="141" x="416" y="586.877">: Encapsulation S2 Auth</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="58" x="358" y="602.477">- Frame 2</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="224" x="416" y="602.477">: Encapsulation None, parent=Frame 1</text><polygon fill="#000000" points="645.5,648.2001,655.5,652.2001,645.5,656.2001,649.5,652.2001" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="349.5" x2="651.5" y1="652.2001" y2="652.2001"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="238" x="356.5" y="631.077">zwave_controller_transport_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="166" x="356.5" y="646.6771">(Frame 2, Parent = Frame 1)</text><polygon fill="#000000" points="866.5,693.4001,876.5,697.4001,866.5,701.4001,870.5,697.4001" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="657.5" x2="872.5" y1="697.4001" y2="697.4001"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="129" x="664.5" y="676.2771">zwave_s2_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="166" x="664.5" y="691.8771">(Frame 2, Parent = Frame 1)</text><polygon fill="#000000" points="668.5,723.0001,658.5,727.0001,668.5,731.0001,664.5,727.0001" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="662.5" x2="877.5" y1="727.0001" y2="727.0001"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="197" x="674.5" y="721.4771">SL_STATUS_NOT_SUPPORTED</text><polygon fill="#000000" points="973.5,768.2001,983.5,772.2001,973.5,776.2001,977.5,772.2001" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="657.5" x2="979.5" y1="772.2001" y2="772.2001"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="129" x="664.5" y="751.0771">zwave_s2_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="166" x="664.5" y="766.6771">(Frame 2, Parent = Frame 1)</text><polygon fill="#000000" points="668.5,797.8001,658.5,801.8001,668.5,805.8001,664.5,801.8001" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="662.5" x2="984.5" y1="801.8001" y2="801.8001"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101" x="674.5" y="796.2771">SL_STATUS_OK</text><polygon fill="#000000" points="360.5,827.4002,350.5,831.4002,360.5,835.4002,356.5,831.4002" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="354.5" x2="656.5" y1="831.4002" y2="831.4002"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101" x="366.5" y="825.8772">SL_STATUS_OK</text><rect fill="#FFFFFF" height="39" style="stroke:#000000;stroke-width:1.0;" width="204" x="354" y="844.4002"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="108" x="358" y="860.4772">Waits that Z-Wave</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="196" x="358" y="876.0772">Transports callbacks for Frame 2.</text><line style="stroke:#000000;stroke-width:1.0;" x1="985.5" x2="1027.5" y1="925.8002" y2="925.8002"/><line style="stroke:#000000;stroke-width:1.0;" x1="1027.5" x2="1027.5" y1="925.8002" y2="938.8002"/><line style="stroke:#000000;stroke-width:1.0;" x1="986.5" x2="1027.5" y1="938.8002" y2="938.8002"/><polygon fill="#000000" points="996.5,934.8002,986.5,938.8002,996.5,942.8002,992.5,938.8002" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="101" x="992.5" y="904.6772">Frame being sent</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="68" x="992.5" y="920.2772">on the radio</text><line style="stroke:#000000;stroke-width:1.0;" x1="1104" x2="1146" y1="1015.2003" y2="1015.2003"/><line style="stroke:#000000;stroke-width:1.0;" x1="1146" x2="1146" y1="1015.2003" y2="1028.2003"/><line style="stroke:#000000;stroke-width:1.0;" x1="1105" x2="1146" y1="1028.2003" y2="1028.2003"/><polygon fill="#000000" points="1115,1024.2003,1105,1028.2003,1115,1032.2003,1111,1028.2003" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="73" x="1111" y="962.8772">continuously</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="50" x="1111" y="978.4772">monitors</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="52" x="1111" y="994.0773">incoming</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="60" x="1111" y="1009.6773">messages</text><polygon fill="#000000" points="996.5,1053.8003,986.5,1057.8003,996.5,1061.8003,992.5,1057.8003" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="990.5" x2="1103" y1="1057.8003" y2="1057.8003"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="1002.5" y="1052.2773">zwapi_poll</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="8" x="1069.5" y="1052.2773">()</text><polygon fill="#000000" points="360.5,1099.0003,350.5,1103.0003,360.5,1107.0003,356.5,1103.0003" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="354.5" x2="984.5" y1="1103.0003" y2="1103.0003"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="106" x="366.5" y="1081.8773">zwapi_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="48" x="476.5" y="1081.8773">callback</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="177" x="366.5" y="1097.4773">(Frame 2 transmission results)</text><polygon fill="#000000" points="866.5,1144.2003,876.5,1148.2003,866.5,1152.2003,870.5,1148.2003" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="349.5" x2="872.5" y1="1148.2003" y2="1148.2003"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126" x="356.5" y="1127.0773">zwave_tx_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="48" x="486.5" y="1127.0773">callback</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="173" x="356.5" y="1142.6773">(frame 2 transmission results)</text><polygon fill="#000000" points="360.5,1196.4004,350.5,1200.4004,360.5,1204.4004,356.5,1200.4004" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="354.5" x2="877.5" y1="1200.4004" y2="1200.4004"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="238" x="366.5" y="1179.2773">zwave_controller_transport_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="48" x="608.5" y="1179.2773">callback</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="338" x="366.5" y="1194.8774">Frame 1 transmission completed (no more to encapsulate)</text><rect fill="#FFFFFF" height="39" style="stroke:#000000;stroke-width:1.0;" width="276" x="354" y="1213.4004"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="358" y="1229.4774">Queue:</text><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="58" x="358" y="1245.0774">- Frame 1</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="210" x="416" y="1245.0774">: Encap. S2 Auth (sent via Frame 2)</text><line style="stroke:#000000;stroke-width:1.0;" x1="349.5" x2="391.5" y1="1310.4004" y2="1310.4004"/><line style="stroke:#000000;stroke-width:1.0;" x1="391.5" x2="391.5" y1="1310.4004" y2="1323.4004"/><line style="stroke:#000000;stroke-width:1.0;" x1="350.5" x2="391.5" y1="1323.4004" y2="1323.4004"/><polygon fill="#000000" points="360.5,1319.4004,350.5,1323.4004,360.5,1327.4004,356.5,1323.4004" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="176" x="356.5" y="1273.6774">Process verifies the TX queue</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="134" x="356.5" y="1289.2774">See that next frame (1)</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="294" x="356.5" y="1304.8774">is to be discarded because of Frame 2 replacing it.</text><polygon fill="#000000" points="123.5,1364.6005,113.5,1368.6005,123.5,1372.6005,119.5,1368.6005" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="117.5" x2="348.5" y1="1368.6005" y2="1368.6005"/><text fill="#000000" font-family="Verdana" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126" x="129.5" y="1347.4774">zwave_tx_send_data</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="48" x="259.5" y="1347.4774">callback</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="173" x="129.5" y="1363.0775">(frame 1 transmission results)</text><!--MD5=[d190e575e922870a59e48cbd8e78f103]
@startuml inline_umlgraph_14.svg
' Style for the diagram
!theme plain
hide footbox

title Z-Wave TX parent frame functionality with transports (example)

' List of participants
participant "User component" as u
participant "Z-Wave TX" as tx #DEDEDE
participant "Z-Wave Transports" as zwave_transports
participant "Z-Wave\nS2" as s2 #DEDEDE
participant "Z-Wave API" as zwapi
participant "Z-Wave RX" as rx #DEDEDE

rnote left of u: I have a frame\nto be encrypted\nand then sent.
u -> tx: <b>zwave_tx_send_data\n(frame data, encapsulation=S2 Auth)

rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encapsulation S2 Auth

tx -> zwave_transports: <b>zwave_controller_transport_send_data</b>\n(Frame 1, no parent)
zwave_transports -> s2: <b>zwave_s2_send_data</b>\n(Frame 1, no parent)
s2 -> zwave_transports: SL_STATUS_OK
zwave_transports -> tx: SL_STATUS_OK

rnote right of tx: Waits that Z-Wave\nTransports callbacks for Frame 1.

loop for as many encapsulated frames needed\n(Nonce Get, Encapsulated frame, etc) to get Frame 1 delivered
  s2 -> tx: <b>zwave_tx_send_data</b>\n(Frame 2 data, encapsulation = None, Parent = Frame 1)
  rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encapsulation S2 Auth\n<b>- Frame 2</b>: Encapsulation None, parent=Frame 1
  tx -> zwave_transports: <b>zwave_controller_transport_send_data</b>\n(Frame 2, Parent = Frame 1)
  zwave_transports -> s2: <b>zwave_s2_send_data</b>\n(Frame 2, Parent = Frame 1)
  s2 -> zwave_transports: SL_STATUS_NOT_SUPPORTED
  zwave_transports -> zwapi: <b>zwave_s2_send_data</b>\n(Frame 2, Parent = Frame 1)
  zwapi -> zwave_transports: SL_STATUS_OK
  zwave_transports -> tx: SL_STATUS_OK

  rnote right of tx: Waits that Z-Wave\nTransports callbacks for Frame 2.

  zwapi -> zwapi: Frame being sent\non the radio
  rx -> rx: continuously\nmonitors\nincoming\nmessages
  rx -> zwapi: <b>zwapi_poll</b>()
  zwapi -> tx: <b>zwapi_send_data</b> callback\n(Frame 2 transmission results)

  tx -> s2: <b>zwave_tx_send_data</b> callback\n(frame 2 transmission results)
end
s2 -> tx: <b>zwave_controller_transport_send_data</b> callback\nFrame 1 transmission completed (no more to encapsulate)

rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encap. S2 Auth (sent via Frame 2)
tx -> tx: Process verifies the TX queue\nSee that next frame (1)\nis to be discarded because of Frame 2 replacing it.

tx -> u: <b>zwave_tx_send_data</b> callback\n(frame 1 transmission results)
@enduml

@startuml inline_umlgraph_14.svg







<style>
  root {
    BackgroundColor white
    FontColor black
    FontName Verdana
    HyperLinkColor blue
    LineColor black
    LineThickness 1
    Margin 5
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  header {
    LineThickness 0
  }
  node {
    MaximumWidth 300
  }
  title {
    FontSize 22
    LineThickness 0
  }
</style>

skinparam ArrowLollipopColor black
skinparam BackgroundColor white
skinparam DefaultFontName Verdana
skinparam DefaultMonospacedFontName Courier
skinparam LifelineStrategy nosolid
skinparam ParticipantPadding 10
skinparam SequenceLifeLineBorderColor black
skinparam Shadowing false
skinparam UseBetaStyle true

skinparam Activity {
  BackgroundColor white
  BarColor black
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam Boundary {
  FontColor black
}
skinparam Box {
  Padding 5
}
skinparam CircledCharacter {
  FontColor black
  FontName Courier
  Radius 9
}
skinparam Class {
  BackgroundColor white
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam ClassAttribute {
  FontColor black
  FontName Verdana
}
skinparam ClassStereotype {
  FontColor black
  FontName Verdana
}
skinparam Footer {
  FontColor black
  FontName Verdana
}
skinparam Header {
  FontColor black
  FontName Verdana
}
skinparam Hyperlink {
  Color blue
}
skinparam IconPackage {
  Color black
  BackgroundColor white
}
skinparam IconPrivate {
  Color black
  BackgroundColor white
}
skinparam IconProtected {
  Color black
  BackgroundColor white
}
skinparam IconPublic {
  Color black
  BackgroundColor white
}
skinparam Note {
  FontColor black
  FontName Verdana
}
skinparam Object {
  BorderColor black
}
skinparam Package {
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam State {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeA {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeC {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeE {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeI {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeN {
  BackgroundColor white
  BorderColor black
}
skinparam UseCaseStereoType {
  FontColor black
  FontName Verdana
}
hide footbox

title Z-Wave TX parent frame functionality with transports (example)

participant "User component" as u
participant "Z-Wave TX" as tx #DEDEDE
participant "Z-Wave Transports" as zwave_transports
participant "Z-Wave\nS2" as s2 #DEDEDE
participant "Z-Wave API" as zwapi
participant "Z-Wave RX" as rx #DEDEDE

rnote left of u: I have a frame\nto be encrypted\nand then sent.
u -> tx: <b>zwave_tx_send_data\n(frame data, encapsulation=S2 Auth)

rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encapsulation S2 Auth

tx -> zwave_transports: <b>zwave_controller_transport_send_data</b>\n(Frame 1, no parent)
zwave_transports -> s2: <b>zwave_s2_send_data</b>\n(Frame 1, no parent)
s2 -> zwave_transports: SL_STATUS_OK
zwave_transports -> tx: SL_STATUS_OK

rnote right of tx: Waits that Z-Wave\nTransports callbacks for Frame 1.

loop for as many encapsulated frames needed\n(Nonce Get, Encapsulated frame, etc) to get Frame 1 delivered
  s2 -> tx: <b>zwave_tx_send_data</b>\n(Frame 2 data, encapsulation = None, Parent = Frame 1)
  rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encapsulation S2 Auth\n<b>- Frame 2</b>: Encapsulation None, parent=Frame 1
  tx -> zwave_transports: <b>zwave_controller_transport_send_data</b>\n(Frame 2, Parent = Frame 1)
  zwave_transports -> s2: <b>zwave_s2_send_data</b>\n(Frame 2, Parent = Frame 1)
  s2 -> zwave_transports: SL_STATUS_NOT_SUPPORTED
  zwave_transports -> zwapi: <b>zwave_s2_send_data</b>\n(Frame 2, Parent = Frame 1)
  zwapi -> zwave_transports: SL_STATUS_OK
  zwave_transports -> tx: SL_STATUS_OK

  rnote right of tx: Waits that Z-Wave\nTransports callbacks for Frame 2.

  zwapi -> zwapi: Frame being sent\non the radio
  rx -> rx: continuously\nmonitors\nincoming\nmessages
  rx -> zwapi: <b>zwapi_poll</b>()
  zwapi -> tx: <b>zwapi_send_data</b> callback\n(Frame 2 transmission results)

  tx -> s2: <b>zwave_tx_send_data</b> callback\n(frame 2 transmission results)
end
s2 -> tx: <b>zwave_controller_transport_send_data</b> callback\nFrame 1 transmission completed (no more to encapsulate)

rnote right of tx: <b>Queue:\n<b>- Frame 1</b>: Encap. S2 Auth (sent via Frame 2)
tx -> tx: Process verifies the TX queue\nSee that next frame (1)\nis to be discarded because of Frame 2 replacing it.

tx -> u: <b>zwave_tx_send_data</b> callback\n(frame 1 transmission results)
@enduml

PlantUML version 1.2022.0(Tue Jan 11 16:16:42 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>